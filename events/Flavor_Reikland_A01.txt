namespace = flavor_reikland

#Intro Event
country_event = { 
	id = flavor_reikland.0
	title = flavor_reikland.0.t 
	desc = flavor_reikland.0.d 
	picture = KARL_FRANZ_eventPicture
	
	fire_only_once = yes
	is_triggered_only = yes 
		
	trigger = {
		NOT = {
			is_year = 2503
		}
		tag = A01
	}

	option = { 
		ai_chance = { factor = 100 }
		name = flavor_reikland.0.a 
		trigger = { }
	
		add_army_professionalism = 0.10
	}
	

}


country_event = { #Bretonnia-Relations
	id = flavor_reikland.2 
	title = flavor_reikland.2.t 
	desc = flavor_reikland.2.d 
	picture = HRE_eventPicture
	fire_only_once = yes
	is_triggered_only = yes 

	trigger = {
		or = {
			tag = A01
			was_tag = A01
		}
	}
	
	option = { 
		ai_chance = { factor = 0 }
		name = flavor_reikland.2.a 
		trigger = { 
			
		}
		clr_country_flag = reikland_befriend_bretonnia_missions
		set_country_flag = reikland_conquer_bretonnia_missions
		custom_tooltip = reikland_conquer_bretonnia_tt
		swap_non_generic_missions = yes 
		parravon_area = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}
		montfont_area = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}
	}
	
	option = { 
		name = flavor_reikland.2.b 
		ai_chance = { factor = 100 }
		trigger = { 
				or = {
					any_country = {
						has_reform = bretonnian_royarch_reform
					}
					tag = A98
				}
		}
		clr_country_flag = reikland_conquer_bretonnia_missions
		set_country_flag = reikland_befriend_bretonnia_missions
		custom_tooltip = reikland_befriend_bretonnia_tt
		swap_non_generic_missions = yes 

			add_historical_friend = event_target:RoyarchOfBretonnia
			event_target:RoyarchOfBretonnia = {
			add_historical_friend = root }
		}
	# WIP failsafe
	# option = { 
	# 	name = flavor_reikland.2.c 
		
	# 	trigger = { 
			
	# 	}
	# 	add_country_modifier = { 
	# 		name = fra_triumph_over_austria_modifier
	# 		duration = -1 
	# 	}
	# 	add_dip_power = 200 
		
	# 	set_country_flag = reikland_conquer_bretonnia_missions
	# 	swap_non_generic_missions = yes
	# }
	#WIP - Previews
	# option = {
	# 	name = flavor_reikland.2.e
	# 	trigger = {
	# 		ai = no
	# 	}
	# 	enable_branching_mission_review_without_ai = { key = A01_BRT }
	# }
}

#Triggered by Reikland Mission 'War in Heaven'
#Choose between revealing the truth of the Lady or Gain her as a Diety
country_event = {
	id = flavor_reikland.3
	title = flavor_reikland.3.t 
	desc = flavor_reikland.3.d
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	is_triggered_only = yes
	
	#Reveal her Origins
	option = {
		name = flavor_reikland.3.a
		
		ai_chance = {
			factor = 1
		}
		
		#add_country_modifier = {
		#	name = "conversion_of_bretonnia"
		#	duration = 7300
		#}
		
		custom_tooltip = " "
		
		define_advisor = {
			type = theologian
			skill = 3
			culture = bretoni
			religion = ROOT
			cost_multiplier = 0.25
		}
		
		if = {
			limit = {
				religion = cult_of_sigmar
			}
			custom_tooltip = A01_every_grail
			hidden_effect = {
				every_country = {
					limit = { 
						religion = lady_of_the_lake 
						knows_country = A01
					}
					country_event = { id = flavor_reikland.4 }
				}
			}
		}
	}
	#Gain lady as a selectable Diety
	option = {
		name = flavor_reikland.3.b
		
		ai_chance = {
			factor = 1
		}
		trigger = {
			religion = cult_of_sigmar
		}
		set_global_flag = cult_of_sigmar_lady_unlocked
	}
}


# Imperials reveal the truth about the Lady
country_event = {
	id = flavor_reikland.4
	title = flavor_reikland.4.t
	desc = flavor_reikland.4.d
	picture = RELIGION_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_reikland.4.a 
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				ai_attitude = {
					who = A01
					attitude = attitude_rivalry
				}
			}
			modifier = {
				factor = 0
				ai_attitude = {
					who = A01
					attitude = attitude_hostile
				}
			}
			modifier = {
				factor = 0
				ai_attitude = {
					who = A01
					attitude = attitude_outraged
				}
			}
		}
		change_religion = cult_of_sigmar
		capital_scope = {
			if = {
				limit = {
					NOT = { religion = cult_of_sigmar }
				}
				change_religion = cult_of_sigmar
			}
		}
		add_stability = -1
		add_prestige = -30
	}
	option = {
		name = flavor_reikland.4.b #The lady has preserved us for this long while Sigmar did nothing
		ai_chance = {
			factor = 1
		}
		add_stability = -3
	}
}

### A Bretonnian Ally ###
#A Shining Opportunity
country_event = {
	id = flavor_reikland.5
	title = flavor_reikland.5.t
	desc = flavor_reikland.5.d
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	
	#Accept
	option = {
		name = flavor_reikland.5.a
		ai_chance = {
			factor = 1
		}
		add_yearly_manpower = 1
		add_army_tradition = 40
		
		custom_tooltip = bretonnian_annex_marriages_tt
		every_country = {
			limit = { culture_group = bretonnian_group marriage_with = ROOT }
			ROOT = { inherit = PREV }
		}
		
		hidden_effect = {
			FROM = { country_event = { id = flavor_reikland.6 days = 7 } }
		}
	}
	
	#Refuse
	option = {
		name = flavor_reikland.5.b
		ai_chance = {
			factor = 0
		}
		
		hidden_effect = {
			FROM = { country_event = { id = flavor_reikland.7 days = 7 } }
		}
	}
}
#They Accepted
country_event = {
	id = flavor_reikland.6
	title = flavor_reikland.6.t
	desc = flavor_reikland.6.d
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = reikland.6.a
		
		tooltip = {
			create_subject = {
				subject_type = vassal
				subject = FROM
			}
		}
		
	}
}
#They Refused
country_event = {
	id = flavor_reikland.7
	title = flavor_reikland.7.t
	desc = flavor_reikland.7.d
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_reikland.7.a
	
	}
}

